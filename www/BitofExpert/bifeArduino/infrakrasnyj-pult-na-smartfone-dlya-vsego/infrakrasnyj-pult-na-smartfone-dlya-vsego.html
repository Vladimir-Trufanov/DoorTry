<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Untitled</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h3 id="инфракрасный-пульт-на-смартфоне-для-всего-2024-01-08">Инфракрасный пульт на смартфоне для всего [2024-01-08]</h3>
<p><b><i></p>
<blockquote>
<p>Новый Год встретили, а Рождество еще не наступило, мы зашевелились - Таня занялась вязанием и своими вязальными семинарами, а я откопал старый Redmi Note 4 и думаю: “Что это телефон пропадает, сделаю-ка я из него универсальный пульт”.</p>
<p>Занялся. Снял на компьютере коды пульта телевизора, коды для подсветки штор. Бар работает на блютуз, сделаю на следующие новогодние каникулы; сейчас, всё равно, не успею. Ну, думаю, заодно и ёлку подключу к пульту. Коды для включения-выключения придумаю, микроконтроллер запрограммирую.</p>
<p>Перебрал удлинитель, сделал выход на реле для подключения к контроллеру. Малость попаял, пристегнул к ёлке датчик, понюхал канифоли, собрал все в кучу. Написал программу для ёлки. В смартфон загрузил все коды.</p>
<p><a href="https://vk.com/wall41932239_1133">VK, 2024.01.08</a></p>
</blockquote>
<p></b></i></p>
<!--
####
-->
<p>В этом материале начнем разбирать, как сделать инфракрасный пульт из смартфона для управления домашней техникой, а именно, в моём конкретном случае, универсальный пульт для управления телевизором, подсветкой штор и включением-выключением Новогодней ёлки и сделаем первый шаг в этом направлении.</p>
<p>Для реализации проекта понадобится следующее:</p>
<p><i></p>
<ul>
<li><p>смартфон, имеющий источник инфракрасного излучения (в моем случае использовался <a href="https://4pda.to/2016/10/16/327024/">Redmi Note 4</a>);</p></li>
<li><p>универсальный пульт дистанционного управления. В настоящее время их существует множество: Galaxy Universal Remote, Samsung Universal TV Remote, Universal Remote for Smart TVs и т.д. Можно использовать любой пульт, который позволяет самостоятельно формировать наборы кодов для управления оборудованием. Я использовал установочный файл приложения <a href="https://4pda.to/forum/index.php?showtopic=486223&amp;st=280#entry56438437">Galaxy Universal Remote v4.1.3 (3.92 МБ)</a>;</p></li>
<li><p>среда разработки скетчей и их загрузки в контроллер - IDE <a href="https://sourceforge.net/projects/arduino.mirror/files/1.8.18/">Arduino 1.8.18</a> или более поздней версии;</p></li>
<li><p>контроллер (например, <a href="https://arduino.ru/Hardware/ArduinoBoardUno">Arduino UNO</a>);</p></li>
<li><p><a href="https://dinistor.ru/product/215">ИК-датчик VS1838B</a>, приёмник инфракрасных сигналов на частоте 38 кГц (или модуль KY-022 с инфракрасным датчиком)</p></li>
</ul>
<p></i></p>
<div id="VS1838B">
<figure>
<img src="ik-datchik-vs1838b.jpg" alt="ИК-датчик VS1838B" /><figcaption>ИК-датчик VS1838B</figcaption>
</figure>
<figure>
<img src="modul-ky-022-s-infrakrasnym-datchikom.jpg" alt="Модуль KY-022 с инфракрасным датчиком" /><figcaption>Модуль KY-022 с инфракрасным датчиком</figcaption>
</figure>
</div>
<h4 id="выбор-кодов-для-универсального-пульта"><a href="#%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BF%D1%83%D0%BB%D1%8C%D1%82%D0%B0">1. Выбор кодов для универсального пульта</a></h4>
<h4 id="скeтч-для-подбора-кодов-makeprontohex"><a href="#%D1%81%D0%BA%D0%B5%D1%82%D1%87-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%B4%D0%B1%D0%BE%D1%80%D0%B0-%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2-makeprontohex">2. Скeтч для подбора кодов MakeProntoHEX</a></h4>
<h4 id="библиография-материалов"><a href="#%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F">3. Библиография материалов</a></h4>
<h4 id="выбор-кодов-универсального-пульта">Выбор кодов универсального пульта</h4>
<p>Существует несколько протоколов кодирования инфракрасных импульсов. Например, дома у меня обнаружились пульты с протоколом Samsung, Nec и даже один “неопределенный” протокол. Неопределенный протокол - это протокол с точки зрения программной библиотеки <strong><em>IRremote 3.5.2</em></strong>, которую я использовал в экспериментах.</p>
<p>Все протоколы изучать не будем, принцип их действия схож, немножечко посмотрим только на первую 8-разрядную версию протокола NEC, а затем доверимся библиотеке IRremote.</p>
<figure>
<img src="One-or-Zero.jpeg" alt="Представление нуля и единицы" /><figcaption>Представление нуля и единицы</figcaption>
</figure>
<p>Для передачи данных используется несущая частота 38 кГц. Идут импульсы -прерываются - идут импульсы -прерываются. Если длительность паузы совпадает с длительностью импульсов - это ноль, если длительность паузы равна трем длительностям сигнала - это единичка.</p>
<p>Ну, а далее протоколами (в том числе и NEC) рассматриваются наборы нулей и единиц, как обычно в компьютерной жизни.</p>
<figure>
<img src="nec8-protocol.jpeg" alt="Структура 8-разрядного протокола NEC" /><figcaption>Структура 8-разрядного протокола NEC</figcaption>
</figure>
<p>Посылка сигналов состоит из стартового импульса и четырех байтов данных – адрес, инвертированное значение адреса, команда, инвертированное значение команды. Адрес и команда передаются дважды для повышения надежности.</p>
<p>Данные передаются младшим битом вперед. Каждый бит начинается с пачки импульсов несущей частоты. Длительность пачки равна 560 мкс. Как уже сказано, путем изменения временного интервала между пачками импульсов осуществляется кодирование нулей и единиц. При передаче логической единицы интервал от начала текущей до начала следующей пачки импульсов составляет 2.25 мс, а при передаче логического нуля – 1.12 мс.</p>
<p>Стартовый импульс представляет собой пачку импульсов несущей частоты длительностью 9 мс. После подачи стартового импульса следует пауза в 4.5 мс.</p>
<p>Посылка, содержащая адрес и команду передается однократно, но при удержании кнопки пульта дистанционного управления через каждые 110 мс излучается код повтора – пачка импульсов несущей частоты длительностью 9мс, пауза в 2.25 мс и пачка импульсов длительностью 560 мкс.</p>
<p>Первая задача, которая стоит перед нами - это подобрать набор кодов для загрузки в пульт. Для её решения соберем схему на базе Arduino Uno и напишем программный скетч для её работы.</p>
<figure>
<img src="vybor-kodov-universalnogo-pulta.png" alt="Подключение инфракрасного датчика" /><figcaption>Подключение инфракрасного датчика</figcaption>
</figure>
<p>Схема простая. На макетной плате размещаем инфракрасный датчик VS1838B. Соединяем сигнальный контакт со вторым цифровым входом контроллера, соединяем “земли” сенсора (датчика) и контроллера и подаем 5В с контроллера на датчик. Вся основная работа будет делаться в программе. Для подбора кодов будем подавать команды с пульта телевизора и с пульта освещения штор. Для включения/выключения ёлочной гирлянды придумаем или подберем свои коды.</p>
<p>Изучение смартфонного приложения <strong><em>Galaxy Universal Remote</em></strong> показало, что можно добиться совместимости с <strong><em>IRremote</em></strong> через набор кодов в формате <strong><em>ProntoHEX</em></strong>. Поэтому и будем подбирать коды в соответствии с данным форматом.</p>
<h4 id="скетч-для-подбора-кодов-makeprontohex"><a href="MakeProntoHEX/MakeProntoHEX.ino">Скетч для подбора кодов MakeProntoHEX</a></h4>
<h4 id="библиография">Библиография:</h4>
<p><a href="https://soltau.ru/index.php/arduino/item/553-kak-podklyuchit-infrakrasnyj-sensor-k-arduino">Как подключить инфракрасный сенсор к Arduino</a></p>
<p><a href="https://vc.ru/tech/868613-kak-rabotaet-infrakrasnyy-pult-poyasnyaem">Как работает инфракрасный пульт? Поясняем - Dmitry LOOKin</a></p>
<p><a href="https://chipenable.ru/index.php/item/96">Описание протокола Nec</a></p>
<p><a href="https://robotclass.ru/tutorials/arduino-ir-remote-control/">Ардуино: инфракрасный пульт и приемник - Олег Евсегнеев</a></p>
<hr />
<h4 id="универсальный-пульт-для-домашней-техники-на-смартфоне-ещё-одно-приложение-для-смартфона">Универсальный пульт для домашней техники на смартфоне (“ещё одно” приложение для смартфона</h4>
<p>Никаких необходимых внешних аппаратных средств. Не требуется сетевое подключения. Разрешения не требуется!</p>
<p>Управляйте телевизором, ТВ-приставкой,кондиционером,цифровой или зеркальной фотокамерой.</p>
<p>Если вы заметили какие-либо ошибки, или ваше устройство не поддерживается, пожалуйста, свяжитесь с нами по support@moletag.com и мы исправим его для вас! Кроме того, если вам не понравиться приложения просто пришлите нам ваши детали заказа, и мы вернем вам деньги.</p>
<p>Примечание:</p>
<p>Это приложение работает только с телефонами, которые имеют встроенный ИК-передатчик (в настоящее время Samsung Galaxy S4, Galaxy Note 3, Galaxy Note 8.0, Galaxy Note 10.1, Galaxy Tab 7.0 Plus, Galaxy Tab 2, Galaxy Tab 3, Galaxy Mega).</p>
<p>В настоящее время поддержка более 350 000 устройств</p>
<h4 id="как-загрузить-коды-в-galaxy-s4-universal-remote-4.1.3."><a href="https://4pda.to/forum/index.php?showtopic=486223&amp;st=360#entry65481762">Как загрузить коды в Galaxy S4 Universal Remote 4.1.3.</a></h4>
<h4 id="рекомендация-с-19-той-страницы">Рекомендация с 19-той страницы</h4>
<p>Инструкция по загрузке кодов:</p>
<ol type="1">
<li>Качаем:</li>
</ol>
<p>а) <a href="https://4pda.to/forum/index.php?showtopic=486223&amp;st=200#entry46652802">Galaxy Universal Remote v3.4.9c.apk</a></p>
<p>б) <a href="https://ds-blobs-1.cdn.devapps.ru/7485567/IR_codes.txt?s=009b1dfdb213fd6e65927b70000000009426fcafe359dce83f6d75e3aaf45c3c">IR_codes.txt</a></p>
<p>в) <a href="https://4pda.to/forum/index.php?showtopic=486223&amp;st=280#entry56438437">Galaxy Universal Remote v4.1.3.apk</a></p>
<ol start="2" type="1">
<li><p>устанавливаем Galaxy Universal Remote v3.4.9c.apk</p></li>
<li><p>ir_codes.txt копируем в внутреннюю SD память телефона [android/data/com.moletag.galaxy.s4.remote/files/].</p></li>
</ol>
<h5 id="замечание-2024.01.03-каталог-был-невидим-с-внешнего-компьютера.-пришлось-перебрасывать-в-каталог-download-а-затем-проводником-перекидывать-в-родной-каталог-который-был-виден-в-проводнике.">Замечание 2024.01.03: Каталог был невидим с внешнего компьютера. Пришлось перебрасывать в каталог Download, а затем проводником перекидывать в родной каталог, который был виден в проводнике.</h5>
<ol start="4" type="1">
<li><p>заходим в программу на вкладку мои пульты и по + добавляем новый пульт</p></li>
<li><p>заходим в наш созданный пульт и добавляем куда-нибудь новую кнопку</p></li>
<li><p>тапаем по новой кнопке и добавляем действие - ввести свой ИК-код</p></li>
<li><p>в нижнем левом углу тап по кнопке с листом бумаги - открыть папку и выбирать наш файл ir_codes.txt</p></li>
<li><p>После чего коды загрузятся в телефон и на вкладке мои пульты появятся 3 пульта: IR_codes, IR_codes2, IR_codes3 в которых полно кнопок с нашими загруженными кодами!</p></li>
<li><p>устанавливаем последнюю версию, в нашем случае - Galaxy Universal Remote v4.1.3.apk, и имеем последнюю версию с пультами IR_codes, IR_codes2, IR_codes3</p></li>
<li><p>идем к устройству с ИК датчиком, например, к древнему телику, которого нет в списке стандартных устройств и подбираем коды из пультов IR_codes, IR_codes2, IR_codes3 !</p></li>
<li><p>А далее творим и создаем свой пульт</p></li>
<li><p>Если все получилось - можно выразить благодарность ув. Alex0047 и ув. egortimofeyev003</p></li>
</ol>
</body>
</html>
